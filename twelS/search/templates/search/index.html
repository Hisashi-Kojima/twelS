{% extends './base.html' %}

{% load static %}

{% block head %}
    <!-- 公開まで検索に引っかからないようにする -->
    <meta name="robots" content="noindex">

    <title>twelS</title>
    <link rel="stylesheet" href="{% static 'search/style.css' %}">
    <link rel="shortcut icon" href="{% static 'search/images/favicon.png' %}">
    <!-- for MathQuill -->
    <link rel="stylesheet" href="{% static 'mathquill-0.10.1/mathquill.css' %}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="{% static 'mathquill-0.10.1/mathquill.js' %}"></script>
{% endblock head %}

{% block body %}
    <div id="main_content">
        <p id="main_form">
            <span id="math-field"></span>
            <button onclick="submit()">検索</button>
        </p>
        <p>LaTeX: <span id="latex"></span></p>

        <!-- queryが有効なもののときのみ表示 -->
        {% if query %}
    　　     <p>{{ query }}  の検索結果</p><br>
        {% else %}
            入力例：E=mc^2
        {% endif %}

        {% for page in page_list %}
            <div class="page">
                <a href="{{ page.uri }}"><h3>{{ page.title }}</h3></a>
                <p>
                    {% autoescape off %}
                        {{ page.description }}
                    {% endautoescape %}
                </p><br>
            </div>
        {% endfor %}

        <!-- queryが有効なもののときのみ表示 -->
        {% if query %}
            <div class="next_page">
                <a href="./?q={{query}}&start={{start}}">更に表示</a>
            </div>
        {% endif %}
    </div>

    <script>
    var mathFieldSpan = document.getElementById('math-field');
    var latexSpan = document.getElementById('latex');

    var MQ = MathQuill.getInterface(2); // for backcompat
    var expr = '';
    var mathField = MQ.MathField(mathFieldSpan, {
        spaceBehavesLikeTab: true, // configurable
        handlers: {
            edit: function() { // useful event handlers
                latexSpan.textContent = mathField.latex(); // simple API
                expr = latexSpan.textContent;
            }
        }
    });

    function submit(){
        var form = document.createElement('form');
        form.action = '.';
        form.method = 'GET';

        var q = document.createElement('input');
        q.value = expr;
        q.name = 'q';
        q.type = 'hidden';
        form.appendChild(q);

        document.body.appendChild(form);

        form.submit();
    }

    </script>
    <script src="{% static 'search/load-mathjax.js' %}" id="MathJax-script" async></script>
{% endblock body %}