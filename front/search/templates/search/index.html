{% extends './base.html' %}

{% load static %}

{% block head %}
    <!-- 公開まで検索に引っかからないようにする -->
    <meta name="robots" content="noindex">

    <title>twelS</title>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
{% endblock head %}

{% block body %}
    <div id="main_content">
        <p id="mathCanvas">数式: <span id="canvas"></span></p>
    <p id="main_form">
        <input type="text" id="textMath" value=""oninput="inputChange()">
        <button onclick="submit()">検索</button>
    </p>

<div class="tab-panel">
    <!--タブ-->
    <ul class="tab-group">
      <li class="tab tab-A is-active">演算子など</li>
      <li class="tab tab-B">ギリシャ文字</li>
      <li class="tab tab-C">その他</li>
   </ul>
    
    <!--タブを切り替えて表示するコンテンツ-->
    <div class="panel-group">
      <div class="panel tab-A is-show">
        <div>
            <button class="buttonGroup" onclick="pushString('+')">\(+\)</button>
            <button class="buttonGroup" onclick="pushString('-')">\(-\)</button>
            <button class="buttonGroup" onclick="pushString('\\times ')">\(\times\)</button>
            <button class="buttonGroup" onclick="pushString('\\div ')">\(\div\)</button>
            <button class="buttonGroup" onclick="pushString('\\frac{x}{y}')">\(\frac{x}{y}\)</button>
            <button class="buttonGroup" onclick="pushString('x^{n}')">\(x^{n}\)</button>
            <button class="buttonGroup" onclick="pushString('x_{n}')">\(x_{n}\)</button>
            <button class="buttonGroup" onclick="pushString('\\sqrt{x}')">\(\sqrt{x}\)</button>
            <button class="buttonGroup" onclick="pushString('\\sqrt[n]{x}')">\(\sqrt[n]{x}\)</button>
            <button class="buttonGroup" onclick="pushString('\\log_{y}{x}')">\(\log_{y}{x}\)</button>
        </div>
        <div>
            <button class="buttonGroup" onclick="pushString('=')">\(=\)</button>
            <button class="buttonGroup" onclick="pushString('\\lt ')">\(\lt\)</button>
            <button class="buttonGroup" onclick="pushString('\\gt ')">\(\gt\)</button>
            <button class="buttonGroup" onclick="pushString('\\ll ')">\(\ll\)</button>
            <button class="buttonGroup" onclick="pushString('\\gg ')">\(\gg\)</button>
            <button class="buttonGroup" onclick="pushString('\\leqq ')">\(\leqq\)</button>
            <button class="buttonGroup" onclick="pushString('\\geqq ')">\(\geqq\)</button>
            <button class="buttonGroup" onclick="pushString('\\wedge ')">\(\wedge\)</button>
            <button class="buttonGroup" onclick="pushString('\\vee ')">\(\vee\)</button>
            <button class="buttonGroup" onclick="pushString('\\cap ')">\(\cap\)</button>
            <button class="buttonGroup" onclick="pushString('\\cup ')">\(\cup\)</button>
        </div>
      </div>
      <div class="panel tab-B">
        <div>
            <button class="buttonGroup" onclick="pushString('\\alpha ')">\(\alpha\)</button>
            <button class="buttonGroup" onclick="pushString('\\beta ')">\(\beta\)</button>
            <button class="buttonGroup" onclick="pushString('\\gamma ')">\(\gamma\)</button>
            <button class="buttonGroup" onclick="pushString('\\delta ')">\(\delta\)</button>
            <button class="buttonGroup" onclick="pushString('\\epsilon ')">\(\epsilon\)</button>
            <button class="buttonGroup" onclick="pushString('\\zeta ')">\(\zeta\)</button>
            <button class="buttonGroup" onclick="pushString('\\eta ')">\(\eta\)</button>
            <button class="buttonGroup" onclick="pushString('\\theta ')">\(\theta\)</button>
            <button class="buttonGroup" onclick="pushString('\\iota ')">\(\iota\)</button>
            <button class="buttonGroup" onclick="pushString('\\kappa ')">\(\kappa\)</button>
            <button class="buttonGroup" onclick="pushString('\\lambda ')">\(\lambda\)</button>
            <button class="buttonGroup" onclick="pushString('\\mu ')">\(\mu\)</button>
        </div>
        <div>
            <button class="buttonGroup" onclick="pushString('\\nu ')">\(\nu\)</button>
            <button class="buttonGroup" onclick="pushString('\\xi ')">\(\xi\)</button>
            <button class="buttonGroup" onclick="pushString('\\o ')">\(o\)</button>
            <button class="buttonGroup" onclick="pushString('\\pi ')">\(\pi\)</button>
            <button class="buttonGroup" onclick="pushString('\\rho ')">\(\rho\)</button>
            <button class="buttonGroup" onclick="pushString('\\sigma ')">\(\sigma\)</button>
            <button class="buttonGroup" onclick="pushString('\\tau ')">\(\tau\)</button>
            <button class="buttonGroup" onclick="pushString('\\upsilon ')">\(\upsilon\)</button>
            <button class="buttonGroup" onclick="pushString('\\phi ')">\(\phi\)</button>
            <button class="buttonGroup" onclick="pushString('\\chi ')">\(\chi\)</button>
            <button class="buttonGroup" onclick="pushString('\\psi ')">\(\psi\)</button>
            <button class="buttonGroup" onclick="pushString('\\omega ')">\(\omega\)</button>
            
        </div>
      </div>
      <div class="panel tab-C">
        <div>
            <button class="buttonGroup" onclick="pushString('\\infty ')">\(\infty\)</button>
            <button class="buttonGroup" onclick="pushString('\\partial ')">\(\partial\)</button>
            <button class="buttonGroup" onclick="pushString('\\nabla ')">\(\nabla\)</button>
            <button class="buttonGroup" onclick="pushString('\\Delta ')">\(\Delta\)</button>
            <button class="buttonGroup" onclick="pushString('\\ln{x}')">\(\ln{x}\)</button>
            <button class="buttonGroup" onclick="pushString('\\int_{b}^{a} f(x) dx')">\(\int_{b}^{a} f(x) dx\)</button>
            <button class="buttonGroup" onclick="pushString('\\lim_{n \\to \\infty}x_{n}')">\(\lim_{n \to \infty}x_{n}\)</button>
        </div>
        <div>
            <button class="buttonGroup" onclick="pushString('f\\left(x\\right)')">\(f\left(x\right)\)</button>
            <button class="buttonGroup" onclick="pushString('\\left| x \\right|')">\(\left| x \right|\)</button>
            <button class="buttonGroup" onclick="pushString('\\sum^{i=1}_{n}x_{i}')">\(\sum^{i=1}_{n}x_{i}\)</button>
            <button class="buttonGroup" onclick="pushString('\\prod^{i=1}_{n}x_{i}')">\(\prod^{i=1}_{n}x_{i}\)</button>
        </div>
      </div>
    </div>
  </div>

        <!-- queryが有効なもののときのみ表示 -->
        {% if query %}
            <p>{{ query }}  の検索結果</p><br>
        {% endif %}

        {% for page in page_list %}
            <div class="page">
                <div class="fade"></div>
                <a href="{{ page.uri }}"><h3>{{ page.title }}</h3></a>
                <p>
                    {% autoescape off %}
                        {{ page.snippet }}
                    {% endautoescape %}
                </p><br>
            </div>
        {% endfor %}

        {% if query %}
            {% if page_list %}
                <div class="next_page">
                    <a href="./?q={{query}}&start={{start}}">更に表示</a>
                </div>
            {% else %}
                <p>検索結果は見つかりませんでした。</p>
            {% endif %}
        {% endif %}
    </div>

    <script>

    function submit(){
        var form = document.createElement('form');
        form.action = '.';
        form.method = 'GET';

        var q = document.createElement('input');
        const obj = document.getElementById("textMath");
        q.value = obj.value;
        q.name = 'q';
        q.type = 'hidden';
        form.appendChild(q);

        document.body.appendChild(form);

        form.submit();
    }

    const canvas = document.getElementById("canvas");

    window.onload = onLoad;

    document.addEventListener('DOMContentLoaded', function(){
        // タブに対してクリックイベントを適用
        const tabs = document.getElementsByClassName('tab');
        for(let i = 0; i < tabs.length; i++) {
            tabs[i].addEventListener('click', tabSwitch, false);
        }

        // タブをクリックすると実行する関数
        function tabSwitch(){
            // タブのclassの値を変更
            document.getElementsByClassName('is-active')[0].classList.remove('is-active');
            this.classList.add('is-active');
            // コンテンツのclassの値を変更
            document.getElementsByClassName('is-show')[0].classList.remove('is-show');
            const arrayTabs = Array.prototype.slice.call(tabs);
            const index = arrayTabs.indexOf(this);
            document.getElementsByClassName('panel')[index].classList.add('is-show');
        };
    }, false);

    function onLoad() {
      target = document.getElementById("textMath");
      target.focus();
      //target.setSelectionRange(0, 0);
    }

    function inputChange(){

        const obj = document.getElementById("textMath");
        canvas.innerHTML = "\\(" + obj.value + "\\)";
        convertMath();
    }

    function convertMath(){
        MathJax.typeset([document.getElementById("canvas")]);
    }

    function pushString(){
        const obj = document.getElementById("textMath");

        const objString = obj.value.substr(0, obj.selectionStart)
			+ "2";
        
        const objCount = objString.length;

        obj.value = obj.value.substr(0, obj.selectionStart)
			+ "2"
			+ obj.value.substr(obj.selectionStart);

        obj.focus();
        obj.setSelectionRange(objCount, objCount);
        canvas.innerHTML = obj.value;
        convertMath();
    }

    function pushString(msg){
        const obj = document.getElementById("textMath");

        const objString = obj.value.substr(0, obj.selectionStart)
			+ msg;
        
        const objCount = objString.length;

        obj.value = obj.value.substr(0, obj.selectionStart)
			+ msg
			+ obj.value.substr(obj.selectionStart);

        obj.focus();
        obj.setSelectionRange(objCount, objCount);
        canvas.innerHTML = "\\(" + obj.value + "\\)";
        convertMath();
    }

    </script>
{% endblock body %}